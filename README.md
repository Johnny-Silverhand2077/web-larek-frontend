# Проектная работа "Веб-ларек"
 
 Стек: HTML, SCSS, TS, Webpack
 
 Структура проекта:
 - src/ — исходные файлы проекта
 - src/components/ — папка с JS компонентами
 - src/components/base/ — папка с базовым кодом
 
 Важные файлы:
 - src/pages/index.html — HTML-файл главной страницы
 - src/types/index.ts — файл с типами
 - src/index.ts — точка входа приложения
 - src/scss/styles.scss — корневой файл стилей
 - src/utils/constants.ts — файл с константами
 - src/utils/utils.ts — файл с утилитами
 
 ## Установка и запуск
 Для установки и запуска проекта необходимо выполнить команды
 
 ```
 npm install
 npm run start
 ```
 
 или
 
 ```
 yarn
 yarn start
 ```
 ## Сборка
 
 ```
 npm run build
 ```
 
 или
 
 ```
 yarn build
 ```


 # Описание
 
 В проекте применен принцип MVP (Model-View-Presenter), который обеспечивает четкое разделение ответственностей между классами Model и View каждый класс выполняет свою определенную роль:
 
 - **Model (Модель)**: работает с данными, выполняет бизнес-логику и управляет состоянием приложения.
 - **View (Представление)**: отвечает за отображение данных пользователю и обработку взаимодействий.
 - **Presenter (Представитель)**: связывает Model и View, обрабатывает события и координирует взаимодействие между слоями.
 
 ## Функции основных частей
 
 - **Model**: хранит и обрабатывает данные приложения, взаимодействует с сервером.
 - **View**: отображает данные, предоставляет интерфейс для взаимодействия с пользователем.
 - **Presenter**: реагирует на действия пользователя, обновляет модель и инициирует обновление представления.
 
 ## Взаимодействие частей
 
 1. Пользователь взаимодействует с **View** (например, кликает на элемент).
 2. **View** генерирует событие и передаёт его **Presenter** через `EventEmitter`.
 3. **Presenter** вызывает методы **Model** для изменения данных.
 4. **Model** обновляет данные и генерирует событие через `EventEmitter`.
 5. **Presenter** обрабатывает событие, запрашивает обновлённые данные из **Model** и вызывает методы **View** для обновления интерфейса.
 
 ---
 
 ## Компоненты приложения
 
 ### Базовые классы
 
 #### Класс `Api`
 **Назначение**: базовый класс для управления HTTP-запросами к серверу. Предоставляет общие методы для работы с API, включая обработку ответов и управление опциями запросов.
 
 **Поля**:
 - `baseUrl: string` - базовый URL для API-запросов.
 - `options: RequestInit` - настройки запросов, включая заголовки и другие параметры.
 
 **Методы**:
 - `handleResponse(response: Response): Promise<object>` -  обработчик ответа сервера.
 - `get(uri: string)` - принимает изменяющеюся часть url-адреса, возвращает ответ от сервера.
 - `post(uri: string, data: object, method: ApiPostMethods = 'POST')`- выполняет POST, PUT или DELETE-запрос на указанный URI с указанными данными.
 ---
 
 #### Класс `EventEmitter`
 **Назначение**: брокер событий, реализующий паттерн **Observer**.
 
 **Поля**:
 - `_events: Map<EventName, Set<Subscriber>>`- хранилище событий и связанных с ними подписчиков.
 
 **Методы**:
 - `on` - подписка на событие.
 - `off`- отписка от события.
 - `emit`- инициирует событие с данными.
 - `onAll`- подписка на все события.
 - `offAll`- сброс всех подписчиков.
 - `trigger`- генерирует событие при вызове.
 ---
 
 ### Слой Model
 
 ### Класс `ApiClient`
 **Назначение**: управление запросами к серверу.
 
 **Поля**
 - `cdn: string` - базовый URL сервера для API.
 - `items: IProduct[]` - массив товаров типа IProduct.
 
 **Методы**
 - `getProductList()`: загружает список товаров с сеервера.
 - `getProduct(id: string)`: загружает товар по его id.
 - `postOrder(order: IOrderData)`: отправляет данные о заказе на сервер.
 ---
 
 #### Класс `AppData`
 **Назначение**: работа с данными, полученными с сервера.
 
 **Поля**
 - `_productsCards: IProduct[]` - хранит список карточек продуктов.
 - `selectedCard: IProduct` - хранит информацию о текущей выбранной карточке товара.
 
 **Методы**
 - `get productCards()`- возвращает текущий массив товаров.
 - `set productCards(data: IProduct[])` - устанавливает новый массив товаров и уведомляет другие части приложения о том, что данные обновлены.
 - `setPreview(item: IProduct)`- устанавливает выбранную карточку товара для предварительного просмотра и уведомляет об этом других подписчиков.
 ---
 
 #### Класс `BasketModel`
 **Назначение**: предназначен для управления корзиной покупок.
 
 **Поля**
 - `basket: IProduct[]` - хранит список текущих товаров в корзине.
 
 **Методы**
 - `get basketProducts()`: возвращает текущий список товаров в корзине.
 - `addToBasket(item: IProduct)`: добавляет товар в корзину.
 - `removeFromBasket(item: IProduct)`: удаляет товар из корзины.
 - `clearBasket()`: очищает корзину, удаляя все товары.
 - `getCounter()`: возвращает количество товаров в корзине.
 - `getTotalSumProducts()`: рассчитывает общую сумму стоимости всех товаров в корзине.
 - `isInBasket(id: string): boolean` - предназначен для проверки, находится ли товар с указанным id в корзине.
 ---
 
 #### Класс `OrderForm`
 **Назначение**: предназначен для управления процессом оформления заказа.
 
 **Поля**
 - `address: string` - хранит адрес доставки заказа.
 - `email: string` - хранит адрес электронной почты пользователя.
 - `phone: string` - хранит номер телефона пользователя.
 - `payment: string`- хранит выбранный способ оплаты.
 
 
 **Методы**
 - `setAddressForm(value: string): void` - устанавливает адрес доставки и проверяет состояние формы.
 - `setOrderForm(field: string, value: string): void` - устанавливает значение для указанного поля формы и обновляет состояние формы контактов.
 - `setPaymentMethod(paymentMethod: string): void` - устанавливает выбранный способ оплаты и обновляет состояние формы.

 - `validationOrder(): boolean` - проверяет, заполнены ли все обязательные поля формы заказа.
 - `validationContact(): boolean` - проверяет, заполнены ли все обязательные поля формы контактов.
 - `getFormState()` - возвращает текущее состояние всей формы, включая валидность и заполненные данные.
 - `validOrder(): void` - выводит ошибку на форме, если не заполнен адрес доставки
 - `validContact(): void` - выводит ошибку, если не заполнены контакты.
 - `updateOrder(): void` - проверяет валидность формы заказа и отправляет событие `order:stateChange` с текущим состоянием формы.
 - `updateContact(): void` - проверяет валидность формы контактов и отправляет событие contacts:stateChange с текущим состоянием формы
 
 ---
 
 ### Слой View
 
 #### **Класс `Basket`**  
 **Назначение**: представляет корзину покупок на веб-странице и содержит логику управления отображением элементов корзины.
 
 **Поля**:  
 - `basket: HTMLElement` - элемент корзины.  
 - `title: HTMLElement` - заголовок корзины.
 - `basketList: HTMLElement` - список товаров в корзине.
 - `button: HTMLButtonElement` -  кнопка для оформления заказа.
 - `basketPrice: HTMLElement` - отображение общей стоимости товаров в корзине.
 - `headerBasketButton: HTMLButtonElement` - кнопка в шапке сайта, которая открывает корзину.
 - `headerBasketCounter: HTMLElement` -  элемент в шапке сайта для отображения количества товаров в корзине.
 
 **Методы**:  
 - `updateBasketView(basket: IProduct[]): void` - обновляет визуальное представление корзины при изменении её содержимого.
 - `set items(items: HTMLElement[])` - сеттер для обновления списка товаров в корзине.
 - `renderSumAllProducts(sumAll: number)` - обновляет общую стоимость товаров в корзине.  
 - `render()` - метод для рендеринга корзины, возвращает клонированный элемент корзины для отображения на странице.   
 ---
 
 #### **Класс `BasketItem`**  
 **Назначение**: предназначен для отображения отдельного товара в корзине.
 
 **Поля**:  
 - `basketItem: HTMLElement` - элемент для отображения товара в корзине.
 - `index: HTMLElement` - элемент для отображения индекса (порядкового номера) товара в корзине.
 - `buttonDelete: HTMLButtonElement` - кнопка для удаления товара из корзины.
 
 **Методы**: 
 - `render(data: IProduct, item: number): HTMLElement` - метод для заполнения данных и отображения товара.
 ---
 
 #### **Класс `Card`**  
 **Назначение**: предназначен для создания карточки товара, отображающей его категорию, название, изображение, цену и кнопку добавления в корзину.  
 
 **Поля**:  
 - `cardElement: HTMLElement` - элемент карточки товара.  
 - `cardCategory: HTMLElement` - элемент, отображающий категорию продукта.
 - `cardImage: HTMLImageElement` - элемент для отображения изображения продукта.
 
 **Методы**:  
 - `render(data: IProduct): HTMLElement` - метод для заполнения данными и отображения карточки товара.  
 ---
 
 #### **Класс `CardPreview`**  
 **Назначение**: предназначен для рендеринга карточек товаров с дополнительным функционалом предпросмотра. Он расширяет функциональность класса Card, добавляя текстовое описание товара и управление состоянием кнопки в зависимости от наличия цены.  
 
 **Поля**: 
 - `text: HTMLElement` - элемент DOM, содержащий текстовое описание товара.
 - `button: HTMLButtonElement` - кнопка взаимодействия с товаром.
 
 **Методы**:
 - `handleAddToBasket(): void` - проверяет активность кнопки добавления в корзину.
 - `getButtonLabel(data: IProduct): string` - метод для определения текста кнопки "Купить" в зависимости от наличия цены и добавления в корзину.
 - `render(data: IProduct): HTMLElement` - метод для рендеринга карточки товара с переданными данными.
 ---
 
 #### **Класс `ContactsForm`**  
 **Назначение**: предназначен для управления формой контактов. Наследуется от Form.
 
 **Поля**:
 - `emailInput: HTMLInputElement` - используется для получения введённого email.
 - `phoneInput: HTMLInputElement` - используется для получения введённого номера телефона.
 
 **Методы**:  
  - `getEventNamespace(): string` - метод возвращает уникальное пространство имен для событий формы.
 - `handleSubmit(): void` - метод обрабатывает отправку формы.
 - `render()` - метод для рендеринга формы и добавления специфичных обработчиков событий для её полей.
 ---

  #### **Класс `Form`** 
 **Назначение**: является абстрактным базовым классом для создания форм. Он обеспечивает общую функциональность для работы с HTML-формами. Используется в ContactsForm и Order.
 
 **Поля**: 
 - `formElement: HTMLElement` - главный элемент формы, созданный из переданного шаблона.
 - `inputAll: HTMLInputElement[]` - массив всех полей ввода формы.
 - `buttonAll: HTMLButtonElement[]` - массив всех кнопок в форме с классом `button_alt`.
 - `buttonSubmit: HTMLButtonElement` - кнопка отправки формы.
 - `formErrors: HTMLElement` - элемент для отображения ошибок формы.
 
 **Методы**: 
 - `addInputListeners(): void` - добавляет слушатели событий input ко всем полям ввода
 - `addSubmitListener(): void` - добавляет слушатель события submit для формы, предотвращает стандартное поведение отправки формы.
 - `displayErrors(): void` - выводит ошибки на форме.
 - `handleSubmit(): void` - определяет логику обработки отправки формы.
 - `getEventNamespace(): string` - определяет уникальное пространство имен для событий.
 - `set isValid(value: boolean)` - сеттер для управления состоянием кнопки отправки.
 - `render(): HTMLElement` - возвращает корневой элемент формы для последующего рендера.
 - `onInputChange(): void` - оповещает систему событий о том, что поля формы изменились.
 ---
 
 #### **Класс `Modal`**  
 **Назначение**: управление отображением модальных окон.  
 
 **Поля**:  
 - `modalElement: HTMLElement` - элемент модального окна.  
 - `contentElement: HTMLElement` - контейнер для контента модального окна.
 - `closeButton: HTMLButtonElement` - кнопка закрытия модального окна.
 
 **Методы**:  
 - `open(): void` - открывает модальное окно.  
 - `close(): void` - закрывает модальное окно.  
 - `setContent(value: HTMLElement | null): void` - устанавливает содержимое модального окна.  
 - `render(): HTMLElement` - отображает модальное окно, вызывая метод open.
 --- 
 
 #### **Класс `Order`** 
 **Назначение**: предназначен для управления формой заказа, включая выбор способа оплаты и обработку отправки формы. Наследуется от Form.
 
 **Поля**:
 Наследуются от Form.
 
 **Методы**: 
 - `getEventNamespace(): string`- метод возвращает пространство имен для событий, связанных с оформлением заказа.
 - `handleSubmit(): void` - метод обработки отправки формы.
 - `render()` - метод рендеринга формы и добавления обработчиков событий для полей ввода и кнопок выбора способа оплаты.
 ---
 
 #### **Класс `Page`** 
 **Назначение**: управляет отображением страницы, включая работу с корзиной, отображение количества товаров в корзине, а также управление галереей карточек товаров.
 
 **Поля**:
 - `headerBasketButton: HTMLButtonElement` - кнопка в шапке сайта для открытия корзины.
 - `headerBasketCounter: HTMLElement` - элемент в шапке, отображающий количество товаров в корзине.
 - `pageWrapper: HTMLElement` - обертка всей страницы.
 - `gallery: HTMLElement` - элемент, в котором отображаются карточки товаров.
 
 **Методы**: 
 - `renderHeaderBasketCounter()` - метод для обновления счетчика товаров в корзине в шапке страницы.
 - `set locked()` - метод для блокировки или разблокировки страницы.
 - `appendCard()` - метод для добавления карточки товара в галерею.
 ---

  #### **Класс `Render`**  
 **Назначение**: служит базовым компонентом для отображения информации о товаре, включая его название и цену. Этот класс служит родительским для других классов, которые отображают продукты, такие как Card, BasketItem.
 
 **Поля**: 
 - `title: HTMLElement` - DOM-элемент, используемый для отображения названия товара.
 - `price: HTMLElement` - DOM-элемент, используемый для отображения цены товара.
 
 **Методы**:
 - `initProductElements(context: HTMLElement): void` - инициализирует элементы title и price в указанном контексте DOM.
 - `setPrice(value: number | null): string` - метод для форматирования цены.
 - `renderTitle(element: HTMLElement, title: string): void` - метод для рендеринга заголовка товара.
 - `renderPrice(element: HTMLElement, price: number | null): void` - метод для рендеринга цены товара.
 ---
 
 #### **Класс `Success`**  
 **Назначение**: отображение сообщения об успешном завершении заказа.
 
 **Поля**:  
 - `successElement: HTMLElement` - элемент для отображения сообщения.  
 - `messageElement: HTMLElement` - элемент для текста сообщения.  
 - `button: HTMLButtonElement` - кнопка для закрытия сообщения об успешной операции.
 
 **Методы**:  
 - `render(total: number): HTMLElement` - возвращает корневой элемент success.  
 ---
 
 ### **Слой Presenter**
 Код, относящийся к слою **Presenter**, реализован в основном скрипте приложения (`index.ts`).
 ---
 
 ## Пример взаимодействия компонентов
 
 **Сценарий: добавление товара в корзину**
 
 1. Пользователь нажимает кнопку "Добавить в корзину" на карточке товара в View (например, в **ProductCardPreview**).
 2. В View компонента **ProductCardPreview** генерируется событие `card:addBasket`, которое передается через EventEmitter в Presenter.
 3. **Presenter** подписан на событие `card:addBasket`.
 4. **BasketModel** добавляет товар в массив `basket` и пересчитывает количество товаров в корзине, генерирует событие через **EventEmitter**, чтобы обновить отображение корзины на экране.
 5. **View** обновляет отображение корзины. **Presenter** получает обновленные данные из **BasketModel** и обновляет отображение в BasketView. BasketView обновляет счетчик товаров в шапке сайта и отображает измененную корзину.
 6. Модальное окно с превью карточки товара закрывается.
 ---
 
 ## Данные и типы
 
 Данные и типы:
 
 1. **Типы данных**:
 
 - `IProduct` - представляет товар с полями, такими как id, title, description, category, price, image.
 - `BasketModel` - управляет состоянием корзины.
 
 2. **Данные**:
 
 - `basket`: массив товаров, добавленных в корзину.
 - `counter`: количество товаров в корзине.
 - `totalSum`: общая стоимость всех товаров в корзине.
 
 ## Реализация процессов через события
 
 Добавление товара в корзину:
 
 - **View** генерирует событие `card:addBasket`.
 - **Presenter** обрабатывает это событие, передает данные в **BasketModel**.
 - **BasketModel** добавляет товар в массив корзины, обновляет счетчик и сумму товаров и генерирует событие `basket:updated`.
 - **Presenter** снова обрабатывает событие, обновляя представление корзины.
 - После того как товар добавлен в корзину, модальное окно с превью товара закрывается с помощью метода `modal.close()`.